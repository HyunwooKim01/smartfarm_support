-- ğŸ“Œ Drop í…Œì´ë¸” (ê¸°ì¡´ í…Œì´ë¸” ì´ˆê¸°í™”)
DROP TABLE IF EXISTS daily_sensor_avg;
DROP TABLE IF EXISTS sensor_data;
DROP TABLE IF EXISTS devices;
DROP TABLE IF EXISTS users;

-- ğŸ‘¤ ì‚¬ìš©ì í…Œì´ë¸”
CREATE TABLE users (
    user_id SERIAL PRIMARY KEY,
    username TEXT UNIQUE NOT NULL,
    password TEXT NOT NULL
);

-- ğŸ›  ì„¼ì„œ ì¥ì¹˜ í…Œì´ë¸”
CREATE TABLE devices (
    device_id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(user_id),
    type TEXT NOT NULL,     -- ì˜ˆ: DHT11, LIGHT, SOIL, CO2, PH ë“±
    name TEXT NOT NULL,
    location TEXT
);

-- ğŸ“ˆ ì‹¤ì‹œê°„ ì„¼ì„œ ë°ì´í„° í…Œì´ë¸” (ì„¼ì„œë³„ ì¹¼ëŸ¼ ë¶„ë¦¬)
CREATE TABLE sensor_data (
    time TIMESTAMPTZ NOT NULL,
    device_id INTEGER REFERENCES devices(device_id),
    temperature DOUBLE PRECISION,
    humidity DOUBLE PRECISION,
    light DOUBLE PRECISION,
    soil DOUBLE PRECISION,
    co2 DOUBLE PRECISION
);

-- â± Timescale í•˜ì´í¼í…Œì´ë¸”ë¡œ ì „í™˜
SELECT create_hypertable('sensor_data', 'time', if_not_exists => TRUE);

-- ğŸ“Š ì¼ë³„ í‰ê·  ì„¼ì„œê°’ ì €ì¥ í…Œì´ë¸”
CREATE TABLE daily_sensor_avg (
    date DATE NOT NULL,
    device_id INTEGER REFERENCES devices(device_id),
    avg_temperature DOUBLE PRECISION,
    avg_humidity DOUBLE PRECISION,
    avg_light DOUBLE PRECISION,
    avg_soil DOUBLE PRECISION,
    avg_co2 DOUBLE PRECISION,
    PRIMARY KEY (date, device_id)
);

-- í…ŒìŠ¤íŠ¸ ì½”ë“œ

INSERT INTO users (username, password)
VALUES ('hanjae', '1234'); 

INSERT INTO devices (user_id, type, name, location)
VALUES 
(1, 'DHT11', 'ì˜¨ìŠµë„ì„¼ì„œ', 'ë¹„ë‹í•˜ìš°ìŠ¤ A-1'),
(1, 'LIGHT', 'ì¡°ë„ì„¼ì„œ', 'ë¹„ë‹í•˜ìš°ìŠ¤ A-2'),
(1, 'SOIL', 'í† ì–‘ì„¼ì„œ', 'ë¹„ë‹í•˜ìš°ìŠ¤ A-3'),
(1, 'CO2', 'ì´ì‚°í™”íƒ„ì†Œì„¼ì„œ', 'ë¹„ë‹í•˜ìš°ìŠ¤ A-4');

